library(testthat)
library(antigen.garnish)
library(data.table)
library(magrittr)

test_that("get_cDNA", {

  # load test data
  dt <- structure(list(cDNA_type = c(">", ">"),
    coding = c("ATGGCAGAGTTCTCCCAGAAGCAGAGGAAACAGAGCGGCAGCGAGGGCCTGGGCAGTGTGGTGGACTTCCTCTTGGCTAATGCTCGATTGGTGCTAGGTGTGGGCGGGGCTGCAGTGCTGGGCATTGCTACCCTGGCTGTAAAGCGGCTCATCGACAGGGCCACCAGCCCTCCAGATGAGGATGACACCAAGGGGGACAGCTGGAAGGAACTGAGCCTGCTGAGAGCCACATCGCCCCAAAAGCCCCAACCCCCTCCTGCTGCCTTCAGCCAGCCCCTAGCTACTGGGTCCCCCTCCCCCTCTGTGCCAGTGGAGCCCACGCCCATTCATTCTCCCACGACACCTAAGTTCAGCACTATAGCACCCCTGTGCCTGACGTTCCAGGAGAGGCTGCTGGCCTTCGAGCGCAAGCATGTGATTACCCCAGAAGCCCACGTGACGTTGGCGAAACAGCTGGCTGGAGACATTGCCTTGGAGCTGCAGGCCTACTTGAGGAGCAAGTTCCCAGAACTGCCCTTTGGTGCACTCGTGCCGGGTGGGCCTCTCTACGACGGGCTCCAGGCAGGGACTGCTGAGCACGTGCGCCTGCTGGCGCCTCTGGAGTTGGAGCCGGGGCTATGGAGCCTGGTACCTGGCGTGGACACTGTGGCCAGGGAGCCTCGATGCTGGGCTGTACGCAGGACTCAGCTTGAGTTTCATCCCCGTGGGTGCAGCCCATGGGACCGCTTCCTGGTGGGGGGCTACCTCTCCTCCCGAGTCTTGCTGGAGCTGCTACGGAAGGCCCTGTCAGCCTCTGTCAACTGGCCAGCCATTGGCAGCCTGCTCGGGTGTCTGATCTGGCCCGATGTGGCTTCGGAGGAGCTGCTGCTCAAAGTGCAACACGAGTGCCTGGAGTTCACTTTAGCTGTGCTCATGGTAGTCCCTGGGGCCAGCACTGATGACCGCCTGCTGCTGGCTTGGCCCCTAGAGGGGCTGGCCAGCAATCTCTGGCTGCAGGATCTATATCCAGTAGAGACCGCCCGTTTGCGGGCCCTGGATGACCAGGATGCTGGTACTCGGCGGAGGTTGTTGCTGCTGCTGTGTGGTATCTGTCGTGGCCATCCGGCTCTAGTGCGGCTGGGCTGGAGCCACCTGACTCAGGTGGTTCTGCATCTGGGTGAAGAGGAAGTGGCCTGGACTGAGGAGGCCTTGGGGGAACGGTTTCTGCAAGCCCTGGAGTTTCTGGTGGGCAGCTTGGAGCAGGCTAGCCTGCCCTGTCACTTCAACCCCAGTGTGAACCTCTTGGGTAACTTCCGGGAAGAGGAGATTGATGACATTGGCTACGTGCTGTACAGCGGCCTCCAGGTTCCTGAAAGCCTATTCTAG",
    "ATGGCGGCCGCCAGCGGCTACACCGACCTGCGGGAGAAGCTCAAGTCCATGACGTCCCGGGACAACTACAAGGCGGGCAGTCGGGAGGCCGCCGCCGCTGCGGCCGCCGCCGTGGCTGCCGCTGCCGCTGCCGCGGCCGCCGCTGAGCCTTACCCGGCGTCCGGGACCACCAAGCGGAAATACCAGGAGGACTCGGACCCCGAGCGCAGCGACTACGAGGAGCATCAGTTGCAGAAGGAGGAAGAGGCGCGCAAGGTGAAGAGCGGCATCCGGCAGATCCGGCTCTTCAGTCAGGATGAGTGCTCCAAGATCGAGGCCCGCATCGATGAGGTGGTGTCCCGCGCCGAGAAGGGCCTGTACAACGAGCACACGGTGGACCGGGCCCCCCTGCGCAACAAGTACTTCTTCGGCGAGGGCTACACGTACGGGGCCCAGCTGCAGAAGCGCGGGCCGGGCCAGGAGCGCCTCTACCCGCCGGGCGACGTCGACGAGATCCCGGACTGGGTGCATCAGCTGGTGATCCAGAAGCTGGTGGAGCACCGCGTCATCCCCGAGGGCTTCGTCAACAGCGCGGTCATCAACGACTACCAGCCCGGCGGCTGCATCGTGTCCCACGTTGACCCCATCCACATCTTCGAGCGCCCCATCGTGTCCGTGTCTTTCTTCAGCGACTCGGCACTTTGCTTCGGCTGCAAGTTCCAGTTCAAGCCCATCCGGGTGTCGGAACCTGTGCTTTCTCTGCCGGTGCGCAGGGGGAGCGTGACTGTGCTCAGTGGGTATGCTGCTGATGAAATCACTCACTGCATACGGCCTCAGGACATTAAGGAACGCCGGGCGGTCATCATTCTCAGGAAGACAAGATTAGATGCACCGCGATTGGAAACAAAATCCCTGAGCAGCTCCACATTGCCACCCAGCTATGCTTCAGATCGCCTGTCAGGAAACACCAGAGACCCTGCGCTGAAACCCAAAAGGTCCCACCGCAAGGCAGACCCTGATGCTGCCCACAGGCCCCGGATCCTGGAAATGGACAAAGAAGAAAACCGGCGGTCTGTGCTCCTGCCCACACACCGGCGGAGGGGGAGTTTTAGCTCTGAGAACTATTGGCGCAAATCCTATGAGTCCTCGGAAGATTGCCCAGAGGCAGCCAGCAGCCCCACCCGCAAGGTGAAGATGAGGAGACACTGA"),
    cDNA_locs = c(718L, 1114L),
    cDNA_locl = c(718L, 1114L),
    cDNA_seq = c("A", "G"),
    cDNA_change = c("c.718T>A", "c.1114T>G")),
    .Names = c("cDNA_type", "coding", "cDNA_locs",
               "cDNA_locl", "cDNA_seq", "cDNA_change"),
    class = c("data.table", "data.frame"),
    row.names = c(NA, -2L))

  # run test
  dto <- get_cDNA(dt)

  testthat::expect_equal(dto$coding_mut,
  c("ATGGCAGAGTTCTCCCAGAAGCAGAGGAAACAGAGCGGCAGCGAGGGCCTGGGCAGTGTGGTGGACTTCCTCTTGGCTAATGCTCGATTGGTGCTAGGTGTGGGCGGGGCTGCAGTGCTGGGCATTGCTACCCTGGCTGTAAAGCGGCTCATCGACAGGGCCACCAGCCCTCCAGATGAGGATGACACCAAGGGGGACAGCTGGAAGGAACTGAGCCTGCTGAGAGCCACATCGCCCCAAAAGCCCCAACCCCCTCCTGCTGCCTTCAGCCAGCCCCTAGCTACTGGGTCCCCCTCCCCCTCTGTGCCAGTGGAGCCCACGCCCATTCATTCTCCCACGACACCTAAGTTCAGCACTATAGCACCCCTGTGCCTGACGTTCCAGGAGAGGCTGCTGGCCTTCGAGCGCAAGCATGTGATTACCCCAGAAGCCCACGTGACGTTGGCGAAACAGCTGGCTGGAGACATTGCCTTGGAGCTGCAGGCCTACTTGAGGAGCAAGTTCCCAGAACTGCCCTTTGGTGCACTCGTGCCGGGTGGGCCTCTCTACGACGGGCTCCAGGCAGGGACTGCTGAGCACGTGCGCCTGCTGGCGCCTCTGGAGTTGGAGCCGGGGCTATGGAGCCTGGTACCTGGCGTGGACACTGTGGCCAGGGAGCCTCGATGCTGGGCTGTACGCAGGACTCAGCTTGAGTTTCATCCCCGTGGGTGCAGCCCAAGGGACCGCTTCCTGGTGGGGGGCTACCTCTCCTCCCGAGTCTTGCTGGAGCTGCTACGGAAGGCCCTGTCAGCCTCTGTCAACTGGCCAGCCATTGGCAGCCTGCTCGGGTGTCTGATCTGGCCCGATGTGGCTTCGGAGGAGCTGCTGCTCAAAGTGCAACACGAGTGCCTGGAGTTCACTTTAGCTGTGCTCATGGTAGTCCCTGGGGCCAGCACTGATGACCGCCTGCTGCTGGCTTGGCCCCTAGAGGGGCTGGCCAGCAATCTCTGGCTGCAGGATCTATATCCAGTAGAGACCGCCCGTTTGCGGGCCCTGGATGACCAGGATGCTGGTACTCGGCGGAGGTTGTTGCTGCTGCTGTGTGGTATCTGTCGTGGCCATCCGGCTCTAGTGCGGCTGGGCTGGAGCCACCTGACTCAGGTGGTTCTGCATCTGGGTGAAGAGGAAGTGGCCTGGACTGAGGAGGCCTTGGGGGAACGGTTTCTGCAAGCCCTGGAGTTTCTGGTGGGCAGCTTGGAGCAGGCTAGCCTGCCCTGTCACTTCAACCCCAGTGTGAACCTCTTGGGTAACTTCCGGGAAGAGGAGATTGATGACATTGGCTACGTGCTGTACAGCGGCCTCCAGGTTCCTGAAAGCCTATTCTAG",
  "ATGGCGGCCGCCAGCGGCTACACCGACCTGCGGGAGAAGCTCAAGTCCATGACGTCCCGGGACAACTACAAGGCGGGCAGTCGGGAGGCCGCCGCCGCTGCGGCCGCCGCCGTGGCTGCCGCTGCCGCTGCCGCGGCCGCCGCTGAGCCTTACCCGGCGTCCGGGACCACCAAGCGGAAATACCAGGAGGACTCGGACCCCGAGCGCAGCGACTACGAGGAGCATCAGTTGCAGAAGGAGGAAGAGGCGCGCAAGGTGAAGAGCGGCATCCGGCAGATCCGGCTCTTCAGTCAGGATGAGTGCTCCAAGATCGAGGCCCGCATCGATGAGGTGGTGTCCCGCGCCGAGAAGGGCCTGTACAACGAGCACACGGTGGACCGGGCCCCCCTGCGCAACAAGTACTTCTTCGGCGAGGGCTACACGTACGGGGCCCAGCTGCAGAAGCGCGGGCCGGGCCAGGAGCGCCTCTACCCGCCGGGCGACGTCGACGAGATCCCGGACTGGGTGCATCAGCTGGTGATCCAGAAGCTGGTGGAGCACCGCGTCATCCCCGAGGGCTTCGTCAACAGCGCGGTCATCAACGACTACCAGCCCGGCGGCTGCATCGTGTCCCACGTTGACCCCATCCACATCTTCGAGCGCCCCATCGTGTCCGTGTCTTTCTTCAGCGACTCGGCACTTTGCTTCGGCTGCAAGTTCCAGTTCAAGCCCATCCGGGTGTCGGAACCTGTGCTTTCTCTGCCGGTGCGCAGGGGGAGCGTGACTGTGCTCAGTGGGTATGCTGCTGATGAAATCACTCACTGCATACGGCCTCAGGACATTAAGGAACGCCGGGCGGTCATCATTCTCAGGAAGACAAGATTAGATGCACCGCGATTGGAAACAAAATCCCTGAGCAGCTCCACATTGCCACCCAGCTATGCTTCAGATCGCCTGTCAGGAAACACCAGAGACCCTGCGCTGAAACCCAAAAGGTCCCACCGCAAGGCAGACCCTGATGCTGCCCACAGGCCCCGGATCCTGGAAATGGACAAAGAAGAAAACCGGCGGTCTGTGCTCCTGCCCACACACCGGCGGAGGGGGAGTTTTAGCTCTGAGAACTATTGGCGCAAAGCCTATGAGTCCTCGGAAGATTGCCCAGAGGCAGCCAGCAGCCCCACCCGCAAGGTGAAGATGAGGAGACACTGA"
  ))
    })